/* CONFIG/ GLOBALS */function debug(e){DEBUG&&DEBUG===1&&console.log(e)}function trimStartingZero(e){e+="";e.substring(0,1)==="0"&&(e=e.substring(1,e.length));return parseInt(e,10)}function parseDT(e){if(e.length===0){debug("dt elem does not exist:"+e);return}var t,n,r;t=e.attr("datetime");t||(t=e.attr("title"));if(!t){debug("could not find time in datetime or title.");debug("dt class:"+e.attr("class"));return}var i=t.split("T");n=i[0].split("-");if(n===null){debug("didn't recognize DT in: "+t);return}return[n,r]}function findHCalendarEvents(){if(!document.getElementById||!document.createElement){debug("No DOM!");return}if($(".hcal_tables")===null){debug("calendar data not found!");return}$(".vevent").each(function(){var e,t,n={summary:$(this).find(".summary").html(),description:$(this).find(".description").html(),time:$(this).find(".time:first").text(),location:$(this).find(".location:first").text()};e=parseDT($(this).find(".dtstart:first"))[0];t=$(this).find(".dtend:first");t.length>0?t=parseDT(t)[0]:t=e;var r=e[2],i=t[2];if(n.summary)if(e[0]<t[0]||e[1]<t[1]||t[1]>e[1]){i=getMonthLength(e[0],e[1]);addEventHashToGlobalDateHash(n,e,r,i);r=1;i=parseInt(t[2],10);addEventHashToGlobalDateHash(n,t,r,i)}else addEventHashToGlobalDateHash(n,e,r,i)});for(var e in globalDateHash)for(var t in globalDateHash[e])$(".hcal_tables").append(makeMonthTable(globalDateHash[e][t],e,t))}function addEventHashToGlobalDateHash(e,t,n,r){for(var i=trimStartingZero(n);i<=trimStartingZero(r);i++){globalDateHash[t[0]]||(globalDateHash[t[0]]={});globalDateHash[t[0]][t[1]]||(globalDateHash[t[0]][t[1]]={});globalDateHash[t[0]][t[1]][i]||(globalDateHash[t[0]][t[1]][i]=[[]]);globalDateHash[t[0]][t[1]][i].push(e)}}function makeMonthTable(e,t,n){var r=getMonthLength(t,n),i=getMonthLength(t,n-1),s=new Date,o=s.getFullYear(),u=s.getMonth()+1,a=s.getDate(),f=new Array(r+1),l,c=document.createElement("table");$(c).append("<caption>"+monthNames[trimStartingZero(n)-1]+" "+t+"</caption>");var h='<tr class="longDays">';for(var p=0;p<dayNames.length;p++)h+='<th scope="col" >'+dayNames[p]+"</th>";h+='</tr><tr class="abbrDays">';for(p=0;p<dayAbbrevs.length;p++)h+='<th scope="col" ><abbr title="'+dayNames[p]+'">'+dayAbbrevs[p]+"</abbr></th>";$(c).append("<thead>"+h+"</tr></thead>");var d=document.createElement("tbody");$(c).append(d);for(p=1;p<=r;p++){f[p]=document.createElement("td");o==t&&u==n&&a==p&&(f[p].className+=" calDayToday");$(f[p]).append('<a href="/happenings/'+n+"/"+p+"/"+t+'/" class="calDayLabel">'+p+"</a>")}for(var v in e){var m='<div class="events">';for(p=0;p<e[v].length;p++){dayTD=f[v-0];if(e[v][p].summary){$(dayTD).addClass("has_events");m+='<div class="event"><h3>'+e[v][p].summary+"</h3> ";var g='<div class="eventDetails"><p>'+$.trim(e[v][p].time)+" "+$.trim(e[v][p].location)+"</p>";e[v][p].description&&(g+='<p class="calEventDesc">'+e[v][p].description+"</p>");g+="</div>";m+=g+"</div>"}}$(dayTD).hasClass("has_events")&&$(dayTD).append(m+"</div>")}var y=new Date(t,n-1,1),b=y.getDay(),w=d.appendChild(document.createElement("tr"));for(p=0;p<b;p++){var E=i-(b-p-1);isNaN(E)&&(E="");$(w).append('<td class="outOfRange"><div class="calDayLabel"> '+E+"</div></td>")}for(p=1;p<=r;p++){w.childNodes.length===7&&(w=d.appendChild(document.createElement("tr")));(w.childNodes.length===0||w.childNodes.length===6)&&$(f[p]).addClass("weekend");w.appendChild(f[p])}var S=1;while(w.childNodes.length<7){$(w).append('<td class="outOfRange"><div class="calDayLabel">'+S+"</div></td>");S++}return c}var DEBUG=0,dayNames=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"),dayAbbrevs=new Array("S","M","T","W","T","F","S"),monthNames=new Array("January","February","March","April","May","June","July","August","September","October","November","December"),monthLength=new Array(31,28,31,30,31,30,31,31,30,31,30,31),globalDateHash={},getMonthLength=function(e,t){return monthLength[t-1]};$(document).ready(findHCalendarEvents);